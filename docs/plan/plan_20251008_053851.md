# Next.js プロジェクト生成時の重複ファイル解決プラン

**プラン ID**: plan_20251008_053851
**作成日時**: 2025-10-08 05:38:51
**対象**: Next.js fullstack-admin テンプレートの `next.config.*` ファイル重複問題

## 問題の概要

Next.js プロジェクト生成時に `next.config.mjs` と `next.config.ts` の2つのファイルが同時に生成される問題が発生している。

### 現状の問題
- `templates/nextjs-fullstack-admin/` に両方のファイルが存在
- `copyTemplateDirectory` が両方のファイルを無差別にコピー
- 開発者にとって混乱を招く状況
- `.ts` ファイルは未使用のまま残る

### 影響
- 開発者がどちらのファイルを編集すべきか判断困難
- ESLint や VS Code で警告が表示される
- `.ts` 側を編集しても設定が反映されないリスク

## 調査結果サマリー

### 技術的背景
- **next.config.mjs**: LibSQL/Prisma設定、webpack設定を含む実用的な設定ファイル
- **next.config.ts**: 基本的な空のテンプレート（実質未使用）
- Next.js は `.mjs` を優先的に読み込むため、`.ts` は評価されない

### ファイル内容分析
- `next.config.mjs`: 52行、詳細な設定（serverExternalPackages、webpack設定等）
- `next.config.ts`: 8行、基本テンプレートのみ

## 実装方針

**採用方針**: `next.config.ts` ファイルをテンプレートから削除

### 選択理由
1. **影響範囲最小**: 既存ユーザーに影響なし
2. **シンプル**: 現行ロジックの変更不要
3. **確実**: ESM設定の複雑さを避けられる
4. **保守性**: テンプレートの整理により保守性向上

## 詳細実装タスク

### 優先度1 (Critical - 必須)
1. **ファイル削除**: `templates/nextjs-fullstack-admin/next.config.ts` を削除
2. **テスト追加**: 生成後に `next.config.mjs` のみ存在することを検証するテスト

### 優先度2 (High - 重要)
3. **既存テスト確認**: nextjs-fullstack-admin関連テストの動作確認
4. **E2Eテスト**: プロジェクト生成の全体検証

### 優先度3 (Medium - 推奨)
5. **コミット作成**: 適切なGitコミットメッセージで変更をコミット
6. **品質確認**: コードレビューと品質チェック

## ファイル変更計画

### 削除対象
- `templates/nextjs-fullstack-admin/next.config.ts`

### 修正対象
- 既存テストファイルで `next.config.ts` の存在を前提としているもの（該当がある場合）

### テスト対象
- `test/unit/src/commands/create/template-generators/nextjs-fullstack-admin.test.ts`
- 統合テスト：プロジェクト生成全体

### 検証対象
- 生成されたプロジェクトで `next.config.mjs` のみ存在すること
- 既存の `next.config.mjs` 内容に変更がないこと

## テスト戦略

### 単体テスト
**対象**: `test/unit/src/commands/create/template-generators/nextjs-fullstack-admin.test.ts`
- 新規テストケース追加：生成後ファイル存在チェック
- `next.config.mjs` のみ存在することを確認
- `next.config.ts` が存在しないことを確認

### 統合テスト
**対象**: 既存テストスイート
- nextjs-fullstack-admin テンプレート生成テストの動作確認
- `copyTemplateDirectory` 機能に変更がないことを確認

### E2Eテスト
**対象**: 実際のプロジェクト生成
- `pnpm dev` → createコマンド → nextjs/fullstack-admin 選択
- 生成されたプロジェクトで `next dev` が正常起動することを確認

### テスト環境
- ローカル開発環境
- Dockerコンテナ内での実行も対応

## リスク分析と対策

### リスク1: 既存ユーザーへの影響
- **確率**: 低
- **理由**: テンプレートファイルの削除のため既存プロジェクトに影響なし
- **対策**: 既存プロジェクトには影響しないことを文書化

### リスク2: テストの失敗
- **確率**: 中
- **理由**: 既存テストが `next.config.ts` の存在を前提としている可能性
- **対策**: 事前に既存テストを確認し、必要に応じて修正

### リスク3: build/dist時の問題
- **確率**: 低
- **理由**: テンプレートのみの変更
- **対策**: プロジェクトのビルドプロセスに影響がないことを確認

### リスク4: 他のテンプレートへの影響
- **確率**: なし
- **理由**: nextjs-fullstack-admin テンプレートのみの変更
- **対策**: 変更範囲を限定し、他のテンプレートに影響しないことを確認

### リスク5: 互換性の問題
- **確率**: 低
- **理由**: Next.js の .mjs ファイル優先読み込みは安定した機能
- **対策**: Next.js公式の設定ファイル優先順位を確認済み

## 実装スケジュール

### フェーズ1: 準備作業 (10分)
- 既存テストの動作確認
- テスト環境の準備

### フェーズ2: 実装作業 (5分)
- `templates/nextjs-fullstack-admin/next.config.ts` の削除
- 新規テストケースの追加

### フェーズ3: 検証作業 (15分)
- 単体テストの実行と確認
- 統合テストの実行と確認
- E2Eテストの実行と確認

### フェーズ4: 完了作業 (5分)
- コミット作成
- 品質チェック
- 文書化完了

**総見積もり時間**: 35分

## 次のアクション

1. **即座に実行**: テンプレートファイル削除とテスト追加
2. **検証**: 全テストスイートの実行と確認
3. **完了**: コミット作成と文書化

## 完了基準

- [ ] `templates/nextjs-fullstack-admin/next.config.ts` が削除されている
- [ ] 生成されたプロジェクトに `next.config.mjs` のみ存在する
- [ ] 既存テストが全て通過する
- [ ] 新規テストケースが追加され、通過する
- [ ] E2Eテストでプロジェクト生成が正常動作する
- [ ] コミットが作成されている

---

**ステータス**: [ STATUS:DONE ]
**実装担当**: Claude Code
**レビュー**: 完了後にコードレビューを実施