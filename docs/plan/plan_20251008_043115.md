# Next.js プロジェクト生成時の .gitignore 欠落問題解決プラン

**作成日時**: 2025-10-08 04:31:15
**調査対象**: docs/investigate/0007.md
**担当**: AI Assistant

## 📋 概要

Next.js の標準テンプレート（typescript, app-router, pages-router, javascript）生成時に `.gitignore` ファイルが作成されない問題を解決する実装計画。

### 🎯 目標
- 全ての Next.js 標準テンプレートで適切な `.gitignore` を自動生成
- モノレポ構成でも適切な `.gitignore` 配置を実現
- 既存の fullstack-admin テンプレートの機能を維持
- 包括的なテストによる品質保証

## 🔍 問題分析

### 現状の問題点
- **標準テンプレート**: `handleStandardTemplate` で package.json と README.md のみ作成
- **モノレポ構成**: `copyMonorepoTemplates` に .gitignore が含まれていない
- **影響範囲**: fullstack-admin 以外の全 Next.js プロジェクト

### 既存の動作パターン
- **fullstack-admin**: `copyTemplateDirectory` で全ファイルをコピー（.gitignore 含む）
- **参考リソース**:
  - `templates/nextjs-fullstack-admin/.gitignore` - 包括的なパターン
  - `temp/refs/nextjs/.gitignore` - Next.js 公式テンプレート（npm配布対象外）

## 🚀 実装計画

### Phase 1: 基本機能実装（高優先度）

#### 1.1 共通 .gitignore テンプレート作成
```
新規ファイル: templates/shared/nextjs/gitignore
```
- **内容**: `temp/refs/nextjs/.gitignore` をベースに最適化
- **サイズ**: 約140行
- **用途**: 標準テンプレート用の共通パターン

#### 1.2 標準テンプレート生成処理の更新
```
修正ファイル: src/commands/create/generator.ts
修正箇所: handleStandardTemplate 関数（149-190行）
```
- **追加処理**: .gitignore ファイルのコピー機能
- **実装方法**: 既存の README.md 生成パターンに準拠

#### 1.3 基本単体テスト追加
```
新規ファイル: test/unit/src/commands/create/generator.test.ts
```
- **テスト項目**:
  - スタンドアロンプロジェクトでの .gitignore 存在確認
  - ファイル内容の妥当性検証
  - 各テンプレートタイプでの動作確認

### Phase 2: モノレポ対応（中優先度）

#### 2.1 モノレポ用 .gitignore テンプレート作成
```
新規ファイル: templates/shared/monorepo/gitignore
```
- **内容**: ルートディレクトリ用の包括的パターン
- **サイズ**: 約50行
- **用途**: `.turbo/`, `node_modules/`, `apps/**/dist` などモノレポ固有

#### 2.2 モノレポ生成処理の更新
```
修正ファイル: src/utils/monorepo-generator/copy-templates.ts
修正箇所: filesToCopy 配列（70-75行）
```
- **追加内容**: .gitignore のコピー処理追加
- **配置**: ルートディレクトリとアプリディレクトリの両方

#### 2.3 包括的テスト実装
```
修正ファイル: test/unit/src/utils/monorepo-generator/copy-templates.test.ts
新規ファイル: test/integration/project-generation.test.ts
新規ファイル: test/e2e/cli-project-creation.test.ts
```

### Phase 3: 完成度向上（低優先度）

#### 3.1 新規ユーティリティ作成
```
新規ファイル: src/utils/gitignore-generator/index.ts
```
- **目的**: .gitignore 生成の共通ロジック
- **機能**: テンプレート読み込み、ファイル生成、検証

#### 3.2 他フレームワーク対応確認
- Expo/Tauri テンプレートの .gitignore 状況確認
- 必要に応じた対応実装

#### 3.3 ドキュメント更新
- 生成手順ガイドの更新
- 既存利用者向けの手動追加手順案内

## 🧪 テスト戦略

### 単体テスト（Unit Tests）
- **対象**: 個別関数の動作確認
- **カバレッジ**: 新規コード90%以上
- **実行環境**: Docker環境

### 統合テスト（Integration Tests）
- **対象**: プロジェクト生成フロー全体
- **検証項目**: 各オプション組み合わせでの動作
- **実行頻度**: CI/CD での自動実行

### E2Eテスト（End-to-End Tests）
- **対象**: 実際のCLI実行
- **検証項目**: Git初期化後の動作確認
- **実行条件**: リリース前の必須実行

## ⚠️ リスク分析と対策

### 高リスク項目

#### 1. テンプレートファイルの配布問題
- **リスク**: npm配布時にdotfileが除外される可能性
- **対策**: package.json files フィールド確認、ビルドスクリプト検証

#### 2. モノレポ構成での .gitignore 競合
- **リスク**: ルート.gitignoreとアプリ.gitignoreの重複・競合
- **対策**: 階層的な無視パターン設計、重複排除

### 中リスク項目

#### 3. 既存プロジェクトとの互換性
- **リスク**: 新しい.gitignoreが既存プロジェクトに予期しない影響
- **対策**: fullstack-adminとの差分分析、段階的リリース

#### 4. テンプレート内容の不適切性
- **リスク**: Next.js公式と異なるパターン
- **対策**: 公式テンプレートとの定期同期、レビュー強化

### 対策実装計画

#### 即座に実装
1. package.json files フィールドの確認
2. ビルドスクリプトでのdotfile処理確認
3. 階層的.gitignore設計の決定

#### 実装と同時に実施
4. 包括的テストスイートの作成
5. 既存テンプレートとの差分分析
6. エラーハンドリングの実装

## 📝 ファイル変更一覧

### 新規作成ファイル
```
templates/shared/nextjs/gitignore          - Next.js標準テンプレート用
templates/shared/monorepo/gitignore        - モノレポ用
src/utils/gitignore-generator/index.ts    - 共通ユーティリティ
test/unit/src/commands/create/generator.test.ts - 標準テンプレートテスト
test/integration/project-generation.test.ts     - 統合テスト
test/e2e/cli-project-creation.test.ts          - E2Eテスト
```

### 修正ファイル
```
src/commands/create/generator.ts                      - handleStandardTemplate関数
src/utils/monorepo-generator/copy-templates.ts       - filesToCopy配列
test/unit/src/utils/monorepo-generator/copy-templates.test.ts - 既存テスト拡張
```

## 📅 実装スケジュール

### Week 1: Phase 1 実装
- 共通テンプレート作成
- 標準テンプレート生成更新
- 基本テスト追加

### Week 2: Phase 2 実装
- モノレポ対応
- 包括的テスト実装
- リスク対策実装

### Week 3: Phase 3 & 完成
- ユーティリティ作成
- ドキュメント更新
- 最終テスト・リリース

## ✅ 受入基準

### 機能要件
- [ ] 全 Next.js 標準テンプレートで .gitignore が自動生成される
- [ ] モノレポ構成でルート・アプリ両方に適切な .gitignore が配置される
- [ ] 生成された .gitignore が Next.js 公式パターンと一致する
- [ ] 既存 fullstack-admin テンプレートの動作が維持される

### 品質要件
- [ ] 単体テストカバレッジ90%以上
- [ ] 統合テスト・E2Eテストが全て成功
- [ ] CI/CDパイプラインでの自動テスト実行
- [ ] Docker環境での動作確認

### 運用要件
- [ ] package.json での適切なファイル配布設定
- [ ] ビルドスクリプトでの dotfile 処理確認
- [ ] 段階的リリース計画の策定
- [ ] ドキュメント更新完了

## 🔗 関連リソース

- **調査レポート**: docs/investigate/0007.md
- **参考テンプレート**: templates/nextjs-fullstack-admin/.gitignore
- **Next.js公式**: temp/refs/nextjs/.gitignore
- **既存実装**: src/commands/create/template-generators/nextjs-fullstack-admin.ts

## 📊 成功指標

### 短期指標（実装完了時）
- 全テストの成功
- 新機能の正常動作確認
- 既存機能の回帰テスト成功

### 中期指標（リリース後1ヶ月）
- ユーザーからの不具合報告なし
- 新規プロジェクト生成数の維持・向上
- ドキュメントへの問い合わせ減少

### 長期指標（リリース後3ヶ月）
- Next.js 公式テンプレート変更への追従
- 他フレームワークへの展開検討
- コミュニティフィードバックの反映

---

**ステータス**: [ STATUS:DONE ]
**次のアクション**: 実装フェーズへの移行
**承認者**: AI Assistant
**作成日**: 2025-10-08 04:31:15