# Nextraドキュメントプロジェクト生成

## 調査サマリー
- Fluorite Flake の CLI は現状アプリ本体のみを生成しており、ドキュメント用の Nextra プロジェクトはテンプレート化されていない。`temp/refs/docs` は動作するリファレンスだが npm 配布対象外のため、`templates/docs/` 等へ昇格させる必要がある。
- モノレポ経路では `createMonorepoStructure` が `apps/web` までしか生成せず (`src/utils/monorepo-generator/create-structure.ts:16`)、`createWebAppPackageJson` もアプリ種別ごとの `package.json` に React 18 系を固定している (`src/utils/monorepo-generator/create-web-app.ts:18`)。Nextra は Next 15 / React 19 / nextra@4.6 を要求するため依存バージョンの整合が課題。
- 参照実装となる Nextra プロジェクトは `web/` ディレクトリに存在し、Next.js App Router + 多言語 (en/ja) + Turbopack 前提で構成されている。`web/package.json:12`、`web/next.config.mjs:20`、`web/src/app/[locale]/layout.tsx:8` などに主要な設定が集約されている。
- モノレポに docs アプリを組み込む場合、`package.json.template` の `dev` スクリプトが `turbo run dev --filter={{PROJECT_NAME}}-web` 固定のため (`templates/monorepo/package.json.template:5`)、docs 向けのタスク追加や Turbo パイプラインの整理が必須。
- CLI の入力フェーズ (`src/commands/create/commands.ts:118`) ではプロジェクトタイプ・テンプレート選択後にドキュメント生成有無を尋ね、確認画面・生成処理の両方で新しいフラグを扱う拡張が求められる。

## 現状整理
- 標準テンプレート生成 (`src/commands/create/generator.ts:153`) では README と `.gitignore`（Next.js 限定）を生成するだけで、docs 用の追加ファイルは無い。モノレポ経路でも `createMonorepoStructure` が `apps/web` のディレクトリだけを先行作成し、docs 領域は考慮されていない。
- `createWebAppPackageJson` は Next.js / Expo / Tauri 向けの 1 パッケージのみを出力し、React 18 系や Expo 51、Tauri 1.6 固定の依存関係を埋め込む設計 (`src/utils/monorepo-generator/create-web-app.ts:18`)。docs 用のワークスペースを追加する余地も API も無い。
- ルートのモノレポテンプレートでは pnpm-workspace に `apps/*` を含めており (`templates/monorepo/pnpm-workspace.yaml:1`)、`apps/docs` を作成すればワークスペース認識は自動で成立する。ただしルート `package.json` の `dev` スクリプト・ドキュメント向けの Turbo パイプラインが未調整。
- `temp/refs/docs` は `.gitignore` により配布されない (`.gitignore:63`)。このままでは CLI 利用者が Nextra プロジェクトを取得できないため、`templates/docs/` など配布対象に移設する設計が必須。

## Nextraテンプレートの構造と依存関係
- 参照実装 (`web/package.json:1`) は Next 15.5.4 / React 19.1.0 / nextra@4.6.0 / nextra-theme-docs@4.6.0 を依存に持ち、Lint・Format は Biome に統一。生成テンプレートでも同じバージョン群を採用するか、追随しやすいようバージョン定義を一元化する必要がある。
- `web/next.config.mjs:1` では `withNextra` ラッパーと `NEXT_PUBLIC_BASE_PATH` に基づく `basePath` 設定、`output: "export"` と `images.unoptimized: true`、`turbopack.resolveAlias.next-mdx-import-source-file` のエイリアスなど静的書き出し前提の設定が入っている。テンプレート化時もこれら値を保持しつつ、環境変数説明を README へ追記するのが望ましい。
- `web/src/app/[locale]/layout.tsx:8` には REPO への Edit Link や i18n メタデータ、バナー／フィードバック設定が集約されている。生成プロジェクトでは CLI 入力値（リポジトリ URL など）が無いため、テンプレートではデフォルト値として Fluorite Flake のままにするか、生成時に `config.name` 等から差し込むロジックを検討する。
- MDX コンポーネントカスタマイズ (`web/src/mdx-components.tsx:1`) と `web/src/content/{en,ja}` のローカライズ済み `index.mdx` 群が存在。テンプレート化する際は初期コンテンツを最小化（例: Getting Started と CLI コマンド概要のみ）し、ユーザーが不要な要素を削除しやすい構成に整理する。
- 補助ファイルとして `tailwind.config.ts`, `postcss.config.mjs`, `globals.css`, `public/fluorite-flake-logo.png` 等がある。生成対象に含めるファイル一覧を明示的に洗い出し、`templates/docs` 配下で保持する。

## モノレポ統合時の主な検討事項
- ディレクトリ構築: `createMonorepoStructure` へ `apps/docs` 追加、あるいはドキュメント生成フラグが真のときだけ `fs.mkdirSync` する分岐を追加する。既存ロジックに副作用を持たせないため、docs 有無を `ProjectConfig` に格納する設計が必要。
- パッケージ生成: docs 用に `createDocsPackageJson` 的なユーティリティを新設し、Next/Nextra 依存を固定。Turbo との連携を考慮し、`scripts.dev` を `next dev --turbopack`、`scripts.build` を `next build --turbopack` に合わせる。
- ルートスクリプト: `templates/monorepo/package.json.template:5` の `dev` は `--filter={{PROJECT_NAME}}-web` に固定されている。利用者がドキュメントを同時起動できるよう、(1) `turbo run dev --parallel --filter={{PROJECT_NAME}}-web --filter={{PROJECT_NAME}}-docs` のように変更する、または (2) `dev:web` / `dev:docs` を追加して用途別に分離する案を比較する。
- Turbo パイプライン: `turbo run build` などは自動的に `apps/docs` を対象に含めるが、docs 側に `build`, `lint`, `typecheck` スクリプトが無いと従属タスクが失敗する。テンプレートの `package.json` に対応スクリプトを整備し、`turbo.json` へ特別な設定が不要な状態に保つ。
- 配布資産: `scripts/copy-templates.mjs:17` が `templates/` をまるごと `dist/templates` へコピーしているため、docs テンプレートを `templates/docs` 配下に置けば追加作業無しで配布可能。ただし `npm pack` 後のファイルサイズを確認し、不要な `node_modules` やビルド成果物を含まないよう `.npmignore`（もしくは `package.json#files`）を再確認する。

## 単一プロジェクト構成（--simple / --no-monorepo）の扱い
- 現行の単体生成ではルート直下に 1 つの `package.json` を出力し (`src/commands/create/generator.ts:167`)、docs のような追加アプリを置く余地が無い。`docs/` ディレクトリ配下に Nextra プロジェクトをそのまま展開し、ルートの `package.json` へ `scripts.docs`（例: `pnpm --filter docs dev`）を追加する案が現実的。
- 非モノレポでの依存管理は pnpm のマルチプロジェクト機能を利用できないため、`npm workspaces` などを導入しない限り docs プロジェクトを完全分離で保持するか、ルート `package.json` に Next/Nextra 依存を混在させることになる。後者は Expo / Tauri テンプレートとの干渉が大きいため、`docs/package.json` を独立させて `pnpm --filter ./docs` 形式で扱う方針が望ましい。
- CLI の `--simple` 選択時はドキュメント生成をデフォルト無効にする、もしくは「単一プロジェクトでは docs は `pnpm --filter ./docs` が必要」という注意文を確認画面に表示するなど UX 上の補助が必要。

## CLI UX / 実装方針ドラフト
- 入力収集 (`collectUserInputs`) に `shouldGenerateDocs` ブール値を追加し、テンプレート決定直後に `@clack/prompts` で `docs` の生成有無を質問する。`ConfirmationInputs` 型にも項目を追加して確認画面で表示する (`src/commands/create/confirmation/index.ts`)。
- `createProjectConfig` が返す `ProjectConfig` に docs フラグを保持するプロパティを追加し、`generateProject` まで引き回す。標準テンプレート経路では docs フラグに基づいて Nextra テンプレートをコピーし、モノレポの場合は `apps/docs` への配置、単体の場合は `docs/` 直下への配置を切り替える。
- テンプレート資産コピーは `copyMonorepoTemplates` とは別の新ユーティリティ（例: `copyDocsTemplate`）を用意し、`templates/docs` をターゲットディレクトリへ再帰コピーする。コピー後に `package.json` の `name` や `docsRepositoryBase` など、プロジェクト固有値を置換する仕組みを整える。
- 確認画面および成功後のガイダンスに、ドキュメントプロジェクトの起動方法（`pnpm --filter {{PROJECT_NAME}}-docs dev` 等）を追記し、ユーザーが即座に docs を立ち上げられるようにする。

## 未解決事項 / 次のアクション
- docs テンプレートの初期コンテンツをどこまで含めるか（完全な公式ドキュメントか、骨組みのみか）を決める。
- `web/` の依存バージョン（Next 15 / React 19 / Nextra 4.6）が CLI 生成物の Node.js 20 サポートと整合するか検証する。特に Expo / Tauri テンプレートと依存衝突が起きないよう peerDependencies を確認する。
- 生成後の自動タスク（`pnpm install` や Turborepo）で docs プロジェクトの依存導入をどう案内するか検討する。モノレポでは `pnpm install` 一度で良いが、単体構成では追加の `pnpm install --filter docs` が必要になる。
- `docs/reviews/` 側のドキュメントや README に、Nextra プロジェクトが生成されること・利用方法を追記するタスクを別途用意する。
