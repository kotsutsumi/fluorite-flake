# Next.js プロジェクト生成時にプロジェクトルートへ .gitignore が配置されない

## 概要
- `pnpm dev new` で Next.js の標準テンプレート（`typescript` / `app-router` / `pages-router` / `javascript`）を生成すると、生成先ディレクトリに `.gitignore` が作成されない。
- `.gitignore` が欠落した状態で初回コミットを行うと、`node_modules/` や `.env*`、Next.js のビルド成果物などが Git 管理下に入るリスクが高い。
- フルスタック管理テンプレート（`fullstack-admin`）は `templates/nextjs-fullstack-admin/.gitignore` をコピーしているため問題が発生しないが、標準テンプレート＋モノレポ有無の全パターンが未対応。

## 影響範囲
- Next.js タイプで `fullstack-admin` 以外を選んだ全プロジェクト（スタンドアロン／モノレポ両方）。
- `apps/web` 直下に Next.js アプリを生成するモノレポ構成の場合も、アプリ側 `.gitignore` が存在しない。
- Expo/Tauri など他タイプは別途確認が必要だが、本件の一次影響は Next.js 標準テンプレートに限定される。

## 再現手順
1. `pnpm dev new` を実行して開発モードの CLI を起動する。
2. Project Type で `Next.js - React-based full-stack web framework` を選択し、Template で `TypeScript with App Router`（または `app-router` / `pages-router` / `javascript`）を選ぶ。
3. Monorepo フラグはどちらでも良い（いずれの場合も再現する）。その他のプロンプトは既定値で確定する。
4. 生成完了後、出力ディレクトリまたは `apps/web` を `ls -a` すると `.gitignore` が存在しない。

```
$ ls -a sample-next
.  ..  README.md  package.json  # ← .gitignore が欠落
```

## 期待される挙動
- Next.js アプリケーションのルートには、公式テンプレート準拠の `.gitignore` が自動生成される。
- モノレポ構成の場合は、`apps/web/.gitignore` の他にリポジトリルート向けの `.gitignore`（`node_modules/`・`.turbo/`・`apps/**/dist` など）も提供し、初期状態で不要なファイルが Git に乗らないようにする。

## 観測結果・調査メモ
- `src/commands/create/generator.ts:149-188`（`handleStandardTemplate`）では、標準テンプレート生成時に `package.json` と `README.md` のみ書き出しており、`.gitignore` の作成処理が存在しない。
- モノレポ構成で呼び出される `src/utils/monorepo-generator/copy-templates.ts` も、`pnpm-workspace.yaml` や `turbo.json` 等はコピーするが `.gitignore` を用意していない。
- `templates/nextjs-fullstack-admin/.gitignore` には Next.js 向けの網羅的な無視パターンが定義されており、Advanced テンプレート経由ではファイルが正しくコピーされる。
- `temp/refs/nextjs/.gitignore` に Next.js 公式テンプレート由来の最新版が保存されており、欠落分のベースラインとして再利用できる（ただし `temp/` は npm 配布対象外なので、そのまま参照は不可）。

## 原因分析
- 標準テンプレートは独自の軽量スキャフォールド（`package.json` と README の手動生成）で済ませており、`.gitignore` を含む追加ファイルの取り扱いが考慮されていない。
- モノレポ構成でも、テンプレートコピー対象ファイルの一覧に `.gitignore` が含まれていないため、ルート／アプリ側ともに無視設定が欠落する。
- `.gitignore` を生成するための共通ユーティリティやリソースファイルが存在しないため、テンプレート間での再利用が行われていない。

## 対応方針案
1. **Next.js 標準テンプレート用の `.gitignore` テンプレートを追加**  
   - `templates/shared/nextjs/gitignore` のような共通ファイルを新設し、`handleStandardTemplate` から書き出す。  
   - コンテンツは `temp/refs/nextjs/.gitignore` をベースに、不要な重複エントリ（`dist/` の二重記載など）があれば整理する。
2. **モノレポ構成での配置ポリシーを決定**  
   - ルート用（`node_modules/`, `.turbo/`, `.vercel/` など）とアプリ用（`apps/web/.env*`, `.next/` など）を分けて生成する。  
   - 既存の `copyMonorepoTemplates` に `.gitignore` を追加するか、生成後にユーティリティでコピーする。
3. **テストと回帰防止**  
   - `test/unit/src/commands/create/template-generators/nextjs-fullstack-admin.test.ts` に倣い、標準テンプレート生成パスに `.gitignore` が含まれるかを検証するテストを追加。  
   - E2E（`test/e2e`）でも生成物の `.gitignore` 有無を確認し、リグレッションを防ぐ。
4. **ドキュメント更新**  
   - 生成手順ガイドがあれば、`.gitignore` の同梱について明記し、既存利用者に対する対応（手動追加手順）を案内する。

## 未決事項・確認ポイント
- Expo / Tauri の標準テンプレートでも同様の欠落がないか要確認。（共通ユーティリティ化する場合はスコープを広げる。）
- `.gitignore` をどの段階で書き出すか（テンプレートコピー時／生成後の追記処理）を決める必要がある。
- `.gitignore` を npm パッケージに含める場合、ビルド時に `scripts/copy-templates.mjs` が dotfile を正しくコピーし続けるか継続的に検証する。

## 参考
- `temp/refs/nextjs/.gitignore` — Next.js 公式テンプレート由来の最新無視設定（実装時はテンプレートディレクトリへ移設する想定）。 
- `templates/nextjs-fullstack-admin/.gitignore` — Advanced テンプレートで既に利用している無視パターン。
