# Prismaのバージョンを最新にする

## 調査サマリー
- 2025-10-07 時点で `npm view prisma version` の結果は `6.17.0`。Prisma CLI / Client 双方で 6.17 系が最新公開バージョン。`npm info` 以外の公式リリースノートはまだ 6.16.3 までしか公開されていないため、詳細な変更点は後日確認が必要。
- リポジトリ直下では Prisma を使用していないが、テンプレートでは Next.js フルスタック管理テンプレートと Expo GraphQL バックエンドが依存。前者は 6.16.3 系、後者は 5.7.0 系を利用しており、両者とも更新余地あり。
- Next.js テンプレートはマイナーアップデート（6.16.3 → 6.17.0）の想定だが、Expo バックエンドはメジャーアップデート（5.x → 6.x）になるため breaking change の洗い出しとマイグレーション確認が必須。

## 現状整理
- `templates/nextjs-fullstack-admin/package.json`
  - `prisma`: `6.16.3`
  - `@prisma/client`: `6.16.3`
  - `@prisma/adapter-libsql`: `^6.16.3`
- `templates/expo-graphql/backend/package.json`
  - `prisma`: `^5.7.0`
  - `@prisma/client`: `^5.7.0`
- Prisma スキーマは `templates/nextjs-fullstack-admin/prisma/` 配下に複数存在（LibSQL / Supabase / ローカル用）。Expo バックエンドは `src/` 配下で Prisma を使用。

## 最新バージョン確認手順
1. `npm view prisma version` → 6.17.0
2. `npm view @prisma/client version` → 6.17.0
3. `npm view @prisma/adapter-libsql version` → 6.17.0
4. GitHub Releases (`https://github.com/prisma/prisma/releases`) を確認したが 2025-10-07 現在は 6.16.3 が最新エントリ。6.17 系の詳細は未掲載のため、エンジニアリングチーム内で差分をウォッチする必要あり。

## 影響評価
- **Next.js テンプレート**
  - CLI / Client / Adapter のパッチ更新で済む見込み。Prisma 6.17.0 の release note が公開され次第、クエリコンパイラやマイグレーションへの影響を確認。
  - テンプレート配下の `prisma/seed.ts` や Turso / Supabase 向けスキーマで API 変更がないか diff を取得する。
- **Expo GraphQL バックエンド**
  - 5 → 6 で `prisma.$transaction` の動作や Data Proxy 関連が変わっている可能性。公式 migration guide（6.0.0 リリースノート）を必ず参照し、生成された Prisma Client の型破壊が起きないか確認する。
  - TypeScript バージョンや Node.js バージョン制約（Prisma 6 は Node 18.17+）に注意。テンプレートの `package.json` では Node エンジン指定がないため、README 等の要件記載を合わせて更新する必要があるか検討。

## 更新作業方針（ドラフト）
1. それぞれのテンプレートで `prisma` / `@prisma/client` / `@prisma/adapter-libsql` のバージョンを 6.17.0（Expo バックエンドは adapter 未使用）に引き上げる。
2. `pnpm install --filter <template>` or `npm install` を実行し、ロックファイルを再生成。
3. `pnpm exec prisma generate` と `pnpm exec prisma migrate diff` でスキーマ整合性を確認。
4. Next.js テンプレート: `pnpm test`（存在する場合）およびアプリ起動 (`pnpm dev`) で Prisma Client のビルドエラーを確認。
5. Expo GraphQL バックエンド: `pnpm build` と GraphQL サーバ起動（`pnpm dev`）で Prisma Client の runtime エラーがないか確認。Seed や Resolver で互換性が取れているかE2Eでテスト。
6. リリースノートが公開されたら breaking change / notable change を調査し、この調査メモとテンプレート README / CHANGELOG を更新。

## 未解決事項 / 次のアクション
- Prisma 6.17.0 の公式リリースノート待ち。公開後に差分を反映。
- Expo GraphQL バックエンド向けの 5 → 6 移行ガイドを追加で調査し、必要なコード変更を列挙する。
- Prisma 6 系で追加された `createManyAndReturn` など新機能の採用有無を検討し、テンプレートに活用できるか検証。
- 依存関係更新後には `docs/reviews/src/...` の対応するレビュー文書も刷新する。
