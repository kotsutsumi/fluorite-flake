# Next.jsプロジェクト生成時に、huskyを導入

## 背景

- `create` コマンドで生成する Next.js プロジェクトに、コミット前検証用の husky フックを同梱したい。
- 生成物の品質維持を狙い、フォーマット・Lint をコミット前に強制するワークフローを明文化する必要がある。

## 調査ゴール

- husky をテンプレートへ追加する際に必要なファイル・スクリプト・依存関係の洗い出し。
- `pnpm` 環境で pre-commit フックを実行するベストプラクティスの整理。
- 生成済みプロジェクトへの後方互換性（既存ユーザーへの影響）と導入手順の検討。

## 調査観点

- **テンプレート構成**: Next.js テンプレートのどこに husky 設定・スクリプトを配置するか。`package.json` の `scripts` や `devDependencies` の変更点を特定。
- **pre-commit スクリプト**: 下記フローを満たす `husky/pre-commit` の内容検証。
  ```
  echo "🔍 Running pre-commit checks..."
  echo "📝 Checking formatting..."
  pnpm run format:check
  echo "🔎 Running linter..."
  pnpm run lint
  echo "⚡ Skipping build check (will run in CI)"
  echo "✅ Pre-commit checks completed!"
  echo "💡 If formatting issues found, run 'pnpm run format' to fix them"
  ```
- **代替手段の比較**: npm scripts のみでの検証や lefthook 等の他ツールとの比較ポイントを整理し、husky 採用理由を明確化。
- **ローカル環境要件**: Node.js 20 + pnpm 前提で問題がないか、`corepack` 利用時の注意点。
- **CI との整合性**: 既存 CI パイプラインでの重複チェックの有無と、ローカルフックの役割分担。

## 調査タスク案

- [ ] Next.js テンプレートの現状構成を確認し、husky 導入に必要なファイル差分を列挙。
- [ ] husky v9 系（最新）で pnpm を利用する際の設定方法・既知の問題を調査。
- [ ] pre-commit フックの実行速度とフォーマット/リントコマンドの依存コストを把握。
- [ ] 生成済みプロジェクトへの導入ステップ（マイグレーションガイド）の下書きを作成。
- [ ] ドキュメント更新範囲（README、チュートリアル）の洗い出しと反映計画の作成。

## 成果物の想定

- husky 導入に必要な変更点の一覧（ファイル、設定、依存パッケージ）。
- 実装に向けたリスク・懸念点と推奨する解決策のサマリ。
- 既存ユーザー向けの導入手順（ドラフト）と FAQ。

## リスク・懸念

- husky のインストールスクリプト実行で Windows / WSL 環境に差異が生じる可能性。→ 代表的な OS での動作確認ポイントを整理。
- pre-commit で `pnpm run lint` が重くなる恐れ。→ lint 対象を限定する等のオプションを検討。
- `format:check` スクリプト未定義の場合のエラー。→ テンプレートに必須スクリプトを同梱し、導入条件を明記。
