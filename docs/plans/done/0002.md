# VercelCLIのnodeラッパー作成

[ STATUS:DONE ]

VercelCLIを直接nodeから利用するとシェル実行のエラー処理などで煩雑になるのを実装側で避けるために
VercelCLIのラッパーモジュールを作成してください。
実際に、VercelCLIが利用できています（認証済み）、テスト作成時、モックテストを準備してほしいですが、
実装時には実際に操作して構いません。
そうしないと返却される値が正確に確認できないためです。
ただ、テスト実行時に毎回プロジェクトが作られるなどされるとこまるので、そこはモックテストにしておいてください。

## 調査メモ（2025-10-04）

- 2025年10月4日時点で https://vercel.com/docs/cli 以下のコマンド別Markdownを取得し、Vercel CLI公式ドキュメントに記載された全コマンドとオプションを確認。
- ドキュメント中のバージョン表記および公式Release Noteから、CLI 48.2.0系の仕様を前提に整理。実装前に `vercel --help` と各サブコマンドの `--help` で差分チェックすること。

## グローバルオプション一覧（共通）

- `--cwd <path>`：実行時の作業ディレクトリを指定。
- `--debug` / `-d`：詳細ログを表示。
- `--global-config <path>` / `-Q`：グローバル設定ディレクトリを明示。
- `--help` / `-h`：ヘルプを表示（`vercel help` と同等）。
- `--local-config <path>` / `-A`：使用する `vercel.json` のパスを指定。
- `--scope <team-or-user>` / `-S`：現在のスコープとは別のチーム／個人で実行。
- `--token <token>` / `-t`：アクセストークンを明示。
- `--no-color`：カラー出力と絵文字を無効化（`NO_COLOR=1` と同等）。

## コマンド別詳細（2025-10-04確認）

### vercel alias

- 概要：デプロイURLとカスタムドメインの紐付け（追加／削除／一覧）。
- サブコマンド：`set <deployment-url> <custom-domain>`、`rm <custom-domain>`、`ls`。
- 固有オプション：
  - `--yes`：`rm` 時の確認をスキップ。
  - `--limit <1-100>`：`ls` で返す件数を指定（既定20、上限100）。

### vercel bisect

- 概要：良品／不良デプロイを指定して二分探索で原因コミットを特定。
- オプション：
  - `--good <deployment>` / `-g`：最初の良品デプロイを事前指定。
  - `--bad <deployment>` / `-b`：最初の不良デプロイを事前指定。
  - `--path <subpath>` / `-p`：検証対象のパスを付加。
  - `--open` / `-o`：各ステップのURLをブラウザで開く。
  - `--run <command>` / `-r`：各デプロイで自動テストを実行し結果で良否判定。

### vercel blob

- 概要：Vercel Blob Storageの操作（`list`/`put`/`del`/`copy` と `store` 系）。
- 主なサブコマンド： `list`、`put <file>`、`del <url|pathname>`、`copy <src> <dest>`、`store add <name> [--region]`、`store remove <id>`、`store get <id>`。
- 固有オプション：
  - `--rw-token <token>`：読み書きトークンを明示。
  - `--limit <1-1000>`、`--cursor <token>`、`--prefix <text>`、`--mode <expanded|folded>`：`list` の絞り込み。
  - `--add-random-suffix`、`--pathname <path>`、`--content-type <mime>`、`--cache-control-max-age <seconds>`、`--force`、`--multipart <true|false>`：`put`/`copy` 時の挙動制御。
  - `--region <region>`：`store add` 用のリージョン指定（既定 `iad1`）。

### vercel build

- 概要：ローカルまたはCIでBuild Output API準拠の成果物を生成。
- オプション：
  - `--prod`：Production環境変数でビルド（既定はPreview）。
  - `--yes`：不足する設定・環境変数を自動取得。
  - `--target <environment>`：対象環境を明示（`production`/`preview`/カスタム）。

### vercel cache

- 概要：CDNキャッシュ／データキャッシュのパージ・無効化。
- サブコマンド例：`purge`（`--type cdn|data`）、`invalidate --tag <tag>`、`dangerously-delete --tag <tag>`。
- オプション：
  - `--yes`：破壊的操作の確認をスキップ。

### vercel certs

- 概要：証明書の発行・一覧・削除。
- サブコマンド例：`ls`、`issue <domains...>`、`rm <id>`。
- オプション：
  - `--challenge-only`：DNSチャレンジ情報のみ表示。
  - `--limit <1-100>`：`ls` の取得件数（既定20）。

### vercel deploy（`vercel` 単独実行を含む）

- 概要：プロジェクトをデプロイ。`vercel` 単独でも実行可能。
- 主要オプション：
  - `--prebuilt`：`.vercel/output` の既存成果物をアップロード。
  - `--build-env KEY=value` / `-b`：ビルド時の環境変数を追加。
  - `--env KEY=value` / `-e`：実行時環境変数を追加。
  - `--yes`：初期設定プロンプトを省略。
  - `--name <project>` / `-n`（非推奨）：デプロイ名を指定。
  - `--prod`：Production環境へ直接デプロイ。
  - `--skip-domain`：`--prod` と併用し自動エイリアス付与を抑止。
  - `--public`：`/_src` でソースを公開。
  - `--regions <region,...>`：Functionsの実行リージョンを制限。
  - `--no-wait`：完了を待たずに終了。
  - `--force` / `-f`：ビルドキャッシュを無視して再デプロイ。
  - `--with-cache`：`--force` 使用時にキャッシュ保持。
  - `--archive=<tgz|zip>`：アップロード前にアーカイブ化。
  - `--logs` / `-l`：ビルドログを同時出力。
  - `--meta KEY=value` / `-m`：デプロイメタデータを付与。
  - `--target <environment>`：デプロイ先環境を明示。

### vercel dev

- 概要：ローカルでVercel環境を再現しFunctions/Middlewareを実行。
- オプション：
  - `--listen <host[:port]>` / `-l`：待受ポート指定。
  - `--yes`：初回リンク時の質問を省略。

### vercel dns

- 概要：DNSレコードの追加・削除・インポート。
- サブコマンド例：`ls`、`add <domain> ...`、`rm <record-id>`、`import <domain> <zonefile>`。
- オプション：
  - `--limit <1-100>`：`ls` の取得件数（既定20）。

### vercel domains

- 概要：ドメインの追加・削除・購入・移管・移動。
- サブコマンド例：`ls`、`inspect`、`add`、`rm`、`buy`、`move`、`transfer-in`。
- オプション：
  - `--yes`：削除などで確認をスキップ。
  - `--limit <1-100>`：`ls` の取得件数（既定20）。
  - `--force`：既存プロジェクトから強制移動。

### vercel env

- 概要：環境変数の追加・削除・一覧・ローカル同期。
- サブコマンド例：`ls [environment] [git-branch]`、`add`、`rm`、`pull [file]`。
- オプション：
  - `--yes`：`pull` 上書きや `rm` の確認をスキップ。
  - `--environment <env>`：`pull` 時に取得対象環境を指定（`development`/`preview`/`production`/カスタム）。
  - `--git-branch <branch>`：ブランチ固有の値を取得。

### vercel git

- 概要：ローカルリポジトリとVercel ProjectのGit連携。
- サブコマンド例：`connect`、`disconnect`。
- オプション：
  - `--yes`：接続時の確認をスキップ。

### vercel help

- 概要：CLI全体または個別コマンドのヘルプを出力。
- 用法：`vercel help`、`vercel help <command>`。固有オプションなし。

### vercel init

- 概要：Vercel公式サンプルからテンプレートを取得。
- サブコマンド：なし（引数にフレームワーク名／出力先ディレクトリ）。
- オプション：
  - `--force` / `-f`：既存ディレクトリを上書き。

### vercel inspect

- 概要：デプロイの詳細やビルドログを取得。
- オプション：
  - `--timeout <ms|duration>`：待機タイムアウト（既定3分）。
  - `--wait`：完了までブロック。
  - `--logs` / `-l`：ビルドログを表示。

### vercel install

- 概要：マーケットプレイスのネイティブインテグレーションをインストール。固有オプションなし。

### vercel integration

- 概要：インテグレーションの追加／一覧／削除／外部ダッシュボード遷移。
- サブコマンド：`add <slug>`、`open <slug>`、`list`、`remove <slug>`。固有オプションなし。

### vercel integration-resource

- 概要：既存インテグレーションのリソースを削除／プロジェクトから切断。
- サブコマンド：`remove <resource> [--disconnect-all]`、`disconnect <resource> [--all|<project>]`。
- オプション：
  - `--disconnect-all`：`remove` 時に関連プロジェクトを一括切断。
  - `--all`：`disconnect` で全プロジェクトを対象。

### vercel link

- 概要：ローカルディレクトリをVercel Projectへリンク。
- サブコマンド：`link [path]`。
- オプション：
  - `--repo`（Alpha）：リポジトリ配下の各プロジェクトを一括リンク（Git連携前提）。
  - `--yes`：対話をスキップ。
  - `--project <name>`：非対話時にプロジェクト名を明示。

### vercel list（`vercel ls`）

- 概要：最近のデプロイ一覧を取得。
- オプション：
  - `--meta key=value` / `-m`：メタデータでフィルタ。
  - `--policy <rule>` / `-p`：保持ポリシー情報を表示。
  - `--environment <env>`：特定環境のデプロイのみ表示。
  - `--yes`：初回リンク時の質問をスキップ。
  - `--status <state>`：CLI 48.2.0 で追加。特定ステータスのデプロイに絞り込み（Release Note参照）。

### vercel login

- 概要：CLIからVercelアカウントへログイン。固有オプションなし。

### vercel logout

- 概要：CLIからログアウト。固有オプションなし。

### vercel logs

- 概要：指定デプロイのランタイムログを取得・追跡。
- オプション：
  - `--json` / `-j`：JSON形式で出力。
  - `--follow` / `-f`（非推奨：現在は既定動作）。
  - `--limit <n>` / `-n`（非推奨）：取得行数を制限。
  - `--output <short|raw>` / `-o`（非推奨）：出力フォーマット指定。
  - `--since <ISO8601>`（非推奨）：指定日時以降のログ。
  - `--until <ISO8601>`（非推奨）：指定日時までのログ。

### vercel project

- 概要：プロジェクトの一覧・追加・削除。
- サブコマンド：`ls`、`add`、`rm`。
- 代表オプション：`ls --json`、`ls --update-required`（Node.jsランタイムの更新が必要なプロジェクトのみ抽出）。

### vercel promote

- 概要：既存デプロイを本番に昇格。
- オプション：
  - `--timeout <duration>`：待機時間（既定3分、`0`で即時終了）。
  - `--yes`：Previewデプロイ昇格時の確認をスキップ。

### vercel pull

- 概要：環境変数とプロジェクト設定を `.vercel/` へ同期。
- オプション：
  - `--yes`：初回リンク時の質問をスキップ。
  - `--environment <env>`：同期対象環境を指定。
  - `--git-branch <branch>`：ブランチ固有設定を取得。

### vercel redeploy

- 概要：既存デプロイを再ビルドして再デプロイ。
- オプション：
  - `--no-wait`：再デプロイ完了を待たず終了。
  - `--target <environment>`：再デプロイ先環境を明示。

### vercel remove（`vercel rm`）

- 概要：デプロイまたはプロジェクト単位で削除。
- オプション：
  - `--safe` / `-s`：プレビュー／本番で使用中のデプロイを除外。
  - `--yes` / `-y`：確認をスキップ。

### vercel rollback

- 概要：現在の本番エイリアスを過去デプロイに戻す。
- オプション：
  - `--timeout <duration>`：待機時間（`0`で即時戻りリクエストのみ）。

### vercel rolling-release（`vercel rr`）

- 概要：ローリングリリース（段階的配信）の設定・実行。
- サブコマンド：`configure --cfg=<json|disable>`、`start --dpl=<deployment>`、`approve --dpl=<deployment> --currentStageIndex=<n>`、`abort --dpl`、`complete --dpl`、`fetch`。
- オプション：
  - `--cfg <json|disable>`：設定内容。
  - `--dpl <deployment-id|url>`：対象デプロイ。
  - `--currentStageIndex <index>`：承認対象ステージ番号。

### vercel switch

- 概要：CLIの現在スコープを別チームへ切替。固有オプションなし。

### vercel teams

- 概要：チームの一覧・作成・招待。固有オプションなし（対話式）。

### vercel telemetry

- 概要：CLIテレメトリの状態確認と opt-in/out。サブコマンド：`status`、`enable`、`disable`。

### vercel whoami

- 概要：現在ログインしているユーザー／チーム情報を表示。
