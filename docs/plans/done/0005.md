# 拡張プロジェクトタイプシステム実装計画

[ STATUS:DONE ]

## 概要
fluorite-flakeのプロジェクト生成機能を拡張し、実用的なアプリケーション開発に必要な機能を含むプロジェクトテンプレートを提供する。

## 現在の実装状況分析

### 既存の構造
```
src/commands/create/
├── commands.ts      # コマンド定義とユーザー入力処理
├── config.ts        # プロジェクト設定生成
├── constants.ts     # プロジェクトテンプレート定数
├── generator.ts     # プロジェクト生成ロジック
├── types.ts         # 型定義
└── validators.ts    # バリデーション
```

### 現在サポートしているプロジェクトタイプ
- `nextjs`: TypeScript, App Router, Pages Router, JavaScript
- `expo`: TypeScript, Tabs, Navigation, JavaScript
- `tauri`: TypeScript, React, Vanilla, JavaScript

### 既存の機能
- モノレポ構造の自動生成
- UltraciteによるLint/Format設定
- 多言語対応（日英）
- プロジェクト名のバリデーション
- 既存ディレクトリの上書き確認

## 実装すべき拡張機能

### 1. Next.js 拡張テンプレート

#### 1.1 Full-Stack Admin Template
**機能要件:**
- ✅ 認証システム（ログイン・ログアウト・セッション管理）
- ✅ 組織管理機能（CRUD操作、ロール管理）
- ✅ ユーザー管理機能（プロフィール、権限設定）
- ✅ プロフィール更新機能（個人情報、設定変更）
- ✅ Ultracite統合（既存プロジェクトと同様）

**技術スタック:**
```typescript
// 依存関係設定
{
  "dependencies": {
    "next": "^14.0.0",
    "@next/bundle-analyzer": "^14.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "@auth/nextjs": "^4.0.0", // 認証
    "prisma": "^5.0.0", // データベースORM
    "@prisma/client": "^5.0.0",
    "zod": "^3.22.0", // スキーマバリデーション
    "react-hook-form": "^7.45.0", // フォーム管理
    "@hookform/resolvers": "^3.3.0",
    "tailwindcss": "^3.3.0", // CSS
    "lucide-react": "^0.263.0" // アイコン
  },
  "devDependencies": {
    "@biomejs/biome": "1.9.4", // Ultracite
    "ultracite": "^0.0.1"
  }
}
```

**ディレクトリ構造:**
```
project-name/
├── app/
│   ├── (auth)/
│   │   ├── login/page.tsx
│   │   └── register/page.tsx
│   ├── (dashboard)/
│   │   ├── organizations/
│   │   │   ├── page.tsx
│   │   │   ├── [id]/page.tsx
│   │   │   └── create/page.tsx
│   │   ├── users/
│   │   │   ├── page.tsx
│   │   │   ├── [id]/page.tsx
│   │   │   └── profile/page.tsx
│   │   └── layout.tsx
│   ├── api/
│   │   ├── auth/[...nextauth]/route.ts
│   │   ├── organizations/route.ts
│   │   └── users/route.ts
│   └── globals.css
├── components/
│   ├── ui/ # shadcn/ui風コンポーネント
│   ├── auth/
│   ├── dashboard/
│   └── shared/
├── lib/
│   ├── auth.ts
│   ├── db.ts
│   ├── schemas.ts
│   └── utils.ts
├── prisma/
│   ├── schema.prisma
│   └── migrations/
├── scripts/
│   ├── vercel-env-setup.sh
│   ├── env-export.js
│   └── env-import.js
└── ultracite.json
```

#### 1.2 Vercel環境変数管理システム
**要件:**
- 環境変数のVercel CLIでの自動設定
- ZIP形式での環境変数共有機能
- 開発・本番環境の分離管理

**実装内容:**
```bash
# scripts/vercel-env-setup.sh
#!/bin/bash
set -e

echo "🔧 Vercel環境変数セットアップ"
vercel env add DATABASE_URL development < .env.development
vercel env add NEXTAUTH_SECRET production < .env.production
vercel env add NEXTAUTH_URL production < .env.production

echo "✅ 環境変数設定完了"
```

```javascript
// scripts/env-export.js
const fs = require('fs');
const path = require('path');
const archiver = require('archiver');

// 環境変数をZIPファイルにエクスポート
async function exportEnvToZip() {
  const output = fs.createWriteStream('env-backup.zip');
  const archive = archiver('zip', { zlib: { level: 9 } });

  archive.pipe(output);
  archive.file('.env.example', { name: 'env-example' });
  archive.file('.env.development', { name: 'env-development' });
  archive.finalize();
}
```

### 2. Expo + Next.js フルスタック

#### 2.1 モバイル + Web統合アーキテクチャ
**プロジェクト構造:**
```
project-name/
├── apps/
│   ├── backend/ (Next.js + GraphQL)
│   │   ├── app/
│   │   │   └── api/
│   │   │       └── graphql/route.ts
│   │   ├── graphql/
│   │   │   ├── schema.graphql
│   │   │   ├── resolvers/
│   │   │   └── types/
│   │   ├── lib/
│   │   │   ├── auth.ts
│   │   │   ├── db.ts
│   │   │   └── graphql.ts
│   │   └── prisma/
│   └── frontend/ (Expo)
│       ├── app/
│       │   ├── (auth)/
│       │   │   ├── login.tsx
│       │   │   └── register.tsx
│       │   ├── (tabs)/
│       │   │   ├── index.tsx
│       │   │   ├── profile.tsx
│       │   │   └── _layout.tsx
│       │   └── _layout.tsx
│       ├── components/
│       ├── hooks/
│       │   └── useAuth.ts
│       ├── graphql/
│       │   ├── queries.ts
│       │   ├── mutations.ts
│       │   └── client.ts
│       └── constants/
├── packages/
│   ├── shared-types/
│   └── config/
└── package.json (workspace設定)
```

#### 2.2 GraphQL実装
**Backend GraphQL Schema:**
```graphql
# graphql/schema.graphql
type User {
  id: ID!
  email: String!
  name: String
  organizations: [Organization!]!
}

type Organization {
  id: ID!
  name: String!
  users: [User!]!
}

type Query {
  me: User
  organizations: [Organization!]!
}

type Mutation {
  login(email: String!, password: String!): AuthPayload!
  register(email: String!, password: String!, name: String): AuthPayload!
  updateProfile(name: String): User!
}

type AuthPayload {
  token: String!
  user: User!
}
```

**Frontend GraphQL Client:**
```typescript
// apps/frontend/graphql/client.ts
import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client';
import { setContext } from '@apollo/client/link/context';
import AsyncStorage from '@react-native-async-storage/async-storage';

const httpLink = createHttpLink({
  uri: process.env.EXPO_PUBLIC_GRAPHQL_URL,
});

const authLink = setContext(async (_, { headers }) => {
  const token = await AsyncStorage.getItem('authToken');
  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : "",
    }
  };
});

export const client = new ApolloClient({
  link: authLink.concat(httpLink),
  cache: new InMemoryCache(),
});
```

### 3. Tauri v2 拡張オプション

#### 3.1 選択可能な構成
**オプション1: Desktop Only**
- Tauriのデスクトップアプリのみ
- React + TypeScript
- Ultracite統合

**オプション2: Desktop + Admin Panel**
- Tauriデスクトップアプリ
- Next.js管理画面（別ポート）
- 両者間のIPC通信

**オプション3: Cross-Platform (Tauri v2)**
- デスクトップアプリ
- モバイルアプリ（Tauri Mobile）
- Next.jsバックエンドAPI

#### 3.2 プロジェクト構造
```
project-name/
├── src-tauri/ (Rust)
│   ├── src/
│   │   ├── main.rs
│   │   ├── commands.rs
│   │   └── lib.rs
│   ├── tauri.conf.json
│   └── Cargo.toml
├── src/ (React)
│   ├── components/
│   ├── pages/
│   ├── hooks/
│   └── main.tsx
├── admin/ (Next.js - オプション)
│   ├── app/
│   ├── components/
│   └── lib/
├── package.json
└── ultracite.json
```

## 実装フェーズ

### Phase 1: 基盤システム拡張
1. ✅ **プロジェクトタイプ選択システム改善**
   - サブオプション選択機能
   - 詳細テンプレート設定

2. ✅ **テンプレート生成エンジン強化**
   - 複数ファイル生成
   - 動的内容生成
   - 依存関係管理

### Phase 2: Next.js拡張テンプレート
1. ✅ **認証システム実装**
   - NextAuth.js統合
   - セッション管理
   - ロール基盤アクセス制御

2. ✅ **管理機能実装**
   - 組織CRUD
   - ユーザー管理
   - プロフィール機能

3. ✅ **Vercel統合**
   - 環境変数管理
   - デプロイスクリプト

### Phase 3: Expo統合
1. ✅ **GraphQLバックエンド**
   - Apollo Server統合
   - Prismaスキーマ
   - 認証リゾルバー

2. ✅ **Expoフロントエンド**
   - Apollo Client
   - 認証フロー
   - ナビゲーション

### Phase 4: Tauri拡張
1. ✅ **選択システム実装**
   - 構成オプション選択UI
   - 条件付きファイル生成

2. ✅ **クロスプラットフォーム対応**
   - Tauri v2設定
   - モバイル対応
   - IPC通信

## 技術的課題と解決策

### 1. テンプレート管理の複雑化
**課題:** 多様なテンプレートとオプションの組み合わせ管理
**解決策:**
- テンプレート定義のJSON設定化
- 動的ファイル生成システム
- モジュラーコンポーネント設計

### 2. 依存関係の競合
**課題:** 異なるフレームワークの依存関係管理
**解決策:**
- Workspace設定による分離
- 共通パッケージの抽象化
- バージョン固定と互換性マトリックス

### 3. 設定ファイルの一貫性
**課題:** Ultracite、Prisma、Next.js等の設定統合
**解決策:**
- 統一設定生成システム
- 設定テンプレートの標準化
- 環境別設定の自動生成

## 実装優先度

### 高優先度
1. ✅ Next.js Full-Stack Admin Template
2. ✅ Vercel環境変数管理システム
3. ✅ プロジェクト選択UI改善

### 中優先度
1. ✅ Expo + GraphQL統合
2. ✅ Tauri選択システム
3. ✅ 共通コンポーネントライブラリ

### 低優先度
1. ✅ Tauri v2 Mobile対応
2. ✅ 高度な認証機能（OAuth, SSO）
3. ✅ プロジェクトテンプレートのカスタマイズ機能

## 成功指標

### 技術指標
- ✅ プロジェクト生成時間 < 30秒
- ✅ 生成されたプロジェクトのビルド成功率 100%
- ✅ テンプレートの型安全性 100%
- ✅ Ultracite統合による品質スコア > 95%

### 機能指標
- ✅ 3つの主要プロジェクトタイプをサポート
- ✅ 各タイプで2-3のサブオプション提供
- ✅ 認証機能の実装時間 < 10分
- ✅ デプロイ準備完了状態での生成

このアップグレードされた実装計画により、fluorite-flakeは単純なボイラープレート生成ツールから、実用的なアプリケーション開発のスターターキットへと進化します。
