# Fluorite-flake ダッシュボード機能

## 1. ダッシュボードシステム概要

Fluorite-flakeのダッシュボード機能は、複数のクラウドサービスを統一インターフェースで監視・管理できる包括的なモニタリングシステムです。サービス非依存のアーキテクチャにより、新しいサービスの追加や既存サービスの拡張が容易に行えます。

### 1.1 ダッシュボードアーキテクチャ概観

```
┌─────────────────────────────────────────────────────────────────┐
│                  ダッシュボードアーキテクチャ                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │  CLI Layer      │    │ Communication   │    │ UI Layer     │ │
│  │                 │    │ Layer           │    │              │ │
│  │ ├ Command       │ ──►│ ├ WebSocket     │ ──►│ ├ TUI        │ │
│  │ │  Routing      │    │ │  Server       │    │ │  Dashboard │ │
│  │ ├ Option        │    │ ├ REST API      │    │ ├ JSON       │ │
│  │ │  Parsing      │    │ │  Server       │    │ │  Output    │ │
│  │ └ Validation    │    │ └ IPC Server    │    │ └ CLI Output │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                     中核管理システム                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │ Dashboard       │    │ Service         │    │ Service      │ │
│  │ Orchestrator    │ ──►│ Factory         │ ──►│ Adapters     │ │
│  │                 │    │                 │    │              │ │
│  │ ├ ライフサイクル │    │ ├ アダプター    │    │ ├ AWS        │ │
│  │ │  管理          │    │ │  インスタンス │    │ ├ Vercel     │ │
│  │ ├ データ集約    │    │ │  生成          │    │ ├ Supabase   │ │
│  │ ├ イベント      │    │ ├ 設定管理      │    │ ├ Turso      │ │
│  │ │  ルーティング  │    │ └ エラー        │    │ ├ GitHub     │ │
│  │ └ メトリクス    │    │   ハンドリング  │    │ └ Cloudflare │ │
│  │   管理          │    │                 │    │              │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 2. サポートサービス

### 2.1 対応クラウドサービス一覧

```
┌─────────────────────────────────────────────────────────┐
│              サポートサービス一覧                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  const SUPPORTED_SERVICES = [                           │
│    'vercel',      // Vercelプロジェクト・デプロイ監視   │
│    'supabase',    // Supabaseプロジェクト・DB監視       │
│    'turso',       // TursoデータベースとAPI監視         │
│    'aws',         // AWS EC2、S3、Lambda監視            │
│    'github',      // GitHubリポジトリとActions監視      │
│    'cloudflare'   // Cloudflare Workers、Pages、R2監視 │
│  ] as const;                                            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2.2 サービス別機能マップ

```
┌─────────────────────────────────────────────────────────┐
│                サービス別機能マップ                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Vercel                                                 │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 機能:                                               │ │
│  │ ├ プロジェクト一覧・詳細表示                       │ │
│  │ ├ デプロイメント履歴・状態監視                     │ │
│  │ ├ ドメイン・環境変数管理                           │ │
│  │ ├ ビルドログ・実行時ログ監視                       │ │
│  │ └ パフォーマンスメトリクス                         │ │
│  │                                                     │ │
│  │ API統合:                                            │ │
│  │ ├ Vercel REST API v9                               │ │
│  │ ├ Team・Personal account対応                        │ │
│  │ └ Webhook統合（リアルタイム更新）                   │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  Supabase                                               │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 機能:                                               │ │
│  │ ├ プロジェクト・組織管理                           │ │
│  │ ├ データベース使用量・パフォーマンス               │ │
│  │ ├ 認証・ストレージ使用状況                         │ │
│  │ ├ Edge Functions実行統計                           │ │
│  │ └ リアルタイム接続監視                             │ │
│  │                                                     │ │
│  │ API統合:                                            │ │
│  │ ├ Supabase Management API                          │ │
│  │ ├ Project統計API                                   │ │
│  │ └ リアルタイムイベント購読                         │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  AWS                                                    │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 機能:                                               │ │
│  │ ├ EC2インスタンス状態監視                          │ │
│  │ ├ S3バケット・使用量統計                           │ │
│  │ ├ Lambda関数実行・エラー監視                       │ │
│  │ ├ CloudWatch メトリクス統合                        │ │
│  │ └ コスト分析・予算アラート                         │ │
│  │                                                     │ │
│  │ API統合:                                            │ │
│  │ ├ AWS SDK v3                                       │ │
│  │ ├ 複数リージョン対応                               │ │
│  │ └ IAM Role・Access Key認証                         │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 3. ダッシュボードオーケストレーター

### 3.1 中央コーディネーター設計

```
┌─────────────────────────────────────────────────────────┐
│            ダッシュボードオーケストレーター              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  export class DashboardOrchestrator extends            │
│                            EventEmitter {               │
│  ┌─────────────────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  主要責任:                                          │ │
│  │  ├ サービスライフサイクル管理                       │ │
│  │  │  ├ アダプター初期化・接続                       │ │
│  │  │  ├ ヘルスチェック・監視                         │ │
│  │  │  └ 適切な切断・クリーンアップ                   │ │
│  │  │                                                 │ │
│  │  ├ コマンドルーティング                             │ │
│  │  │  ├ CLI→サービス操作のマッピング                 │ │
│  │  │  ├ バッチ操作のサポート                         │ │
│  │  │  └ エラーハンドリング・再試行                   │ │
│  │  │                                                 │ │
│  │  ├ データ集約・配信                                 │ │
│  │  │  ├ マルチサービスメトリクス統合                 │ │
│  │  │  ├ リアルタイムイベントストリーミング           │ │
│  │  │  └ フィルタリング・変換                         │ │
│  │  │                                                 │ │
│  │  └ 通信プロトコル管理                               │ │
│  │     ├ WebSocket・REST APIサーバー                  │ │
│  │     ├ 認証・認可制御                               │ │
│  │     └ レート制限・スロットリング                   │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  設定インターフェース:                                  │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ export interface DashboardConfig {                  │ │
│  │   refreshInterval: number;                          │ │
│  │   autoInitServices: string[];                       │ │
│  │   auth?: Record<string, AuthConfig>;                │ │
│  │   protocol: {                                       │ │
│  │     primary: 'websocket' | 'rest';                  │ │
│  │     wsPort: number;                                 │ │
│  │     httpPort: number;                               │ │
│  │     authToken?: string;                             │ │
│  │   };                                                │ │
│  │   display: {                                        │ │
│  │     theme: 'dark' | 'light' | 'auto';               │ │
│  │     layout: 'grid' | 'tabs' | 'split';              │ │
│  │     maxConnections: number;                         │ │
│  │   };                                                │ │
│  │   filters: {                                        │ │
│  │     project?: string;                               │ │
│  │     region?: string;                                │ │
│  │     environment?: string;                           │ │
│  │   };                                                │ │
│  │ }                                                   │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.2 サービスアダプターインターフェース

```
┌─────────────────────────────────────────────────────────┐
│              サービスアダプターインターフェース          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  export interface ServiceAdapter {                      │
│  ┌─────────────────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  ライフサイクル管理:                                │ │
│  │  ├ connect(): Promise<void>                         │ │
│  │  ├ disconnect(): Promise<void>                      │ │
│  │  ├ isConnected(): boolean                           │ │
│  │  └ getHealthStatus(): Promise<HealthStatus>         │ │
│  │                                                     │ │
│  │  データ取得:                                        │ │
│  │  ├ getDashboardData(opts?):                         │ │
│  │  │   Promise<ServiceDashboardData>                  │ │
│  │  ├ getMetrics(opts?): Promise<ServiceMetrics>       │ │
│  │  ├ getLogs(opts?): Promise<LogEntry[]>              │ │
│  │  └ getServiceStatus(): Promise<ServiceStatus>       │ │
│  │                                                     │ │
│  │  操作実行:                                          │ │
│  │  ├ executeAction(action: ServiceAction):            │ │
│  │  │   Promise<ActionResult>                          │ │
│  │  ├ listProjects(): Promise<Project[]>               │ │
│  │  ├ getProjectDetails(id: string):                   │ │
│  │  │   Promise<ProjectDetails>                        │ │
│  │  └ getDeployments(projectId: string):               │ │
│  │      Promise<Deployment[]>                          │ │
│  │                                                     │ │
│  │  イベント処理:                                      │ │
│  │  ├ on(event: string, listener: Function): void      │ │
│  │  ├ emit(event: string, ...args: any[]): boolean     │ │
│  │  └ removeListener(event: string,                    │ │
│  │                  listener: Function): void          │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  データ型定義:                                          │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ export interface ServiceDashboardData {             │ │
│  │   service: string;                                  │ │
│  │   timestamp: number;                                │ │
│  │   projects: Project[];                              │ │
│  │   metrics: ServiceMetrics;                          │ │
│  │   status: ServiceStatus;                            │ │
│  │   health: HealthStatus;                             │ │
│  │ }                                                   │ │
│  │                                                     │ │
│  │ export interface ServiceMetrics {                   │ │
│  │   requests: number;                                 │ │
│  │   errors: number;                                   │ │
│  │   responseTime: number;                             │ │
│  │   uptime: number;                                   │ │
│  │   customMetrics?: Record<string, number>;           │ │
│  │ }                                                   │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 4. 通信アーキテクチャ

### 4.1 マルチプロトコル対応

```
┌─────────────────────────────────────────────────────────┐
│                  通信アーキテクチャ                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  プロトコル階層:                                        │
│  ┌─────────────────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  WebSocket Layer (主要プロトコル)                   │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 用途: リアルタイム双方向通信                    │ │ │
│  │  │ ポート: 9123 (デフォルト)                       │ │ │
│  │  │ 機能:                                           │ │ │
│  │  │ ├ JSON-RPC 2.0 プロトコル                      │ │ │
│  │  │ ├ 自動再接続・ハートビート                     │ │ │
│  │  │ ├ メッセージキューイング                       │ │ │
│  │  │ ├ バイナリデータストリーミング                 │ │ │
│  │  │ └ 圧縮・暗号化サポート                         │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │                                                     │ │
│  │  REST API Layer (フォールバック)                    │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 用途: ステートレス操作・外部統合                │ │ │
│  │  │ ポート: 3000 (デフォルト)                       │ │ │
│  │  │ 機能:                                           │ │ │
│  │  │ ├ OpenAPI 3.0準拠                              │ │ │
│  │  │ ├ JWT認証・認可                                │ │ │
│  │  │ ├ レート制限・スロットリング                   │ │ │
│  │  │ ├ CORS・セキュリティヘッダー                   │ │ │
│  │  │ └ Swagger UI・ドキュメント                     │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │                                                     │ │
│  │  IPC Layer (プロセス間通信)                         │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 用途: ローカルプロセス間・Tauriサイドカー       │ │ │
│  │  │ プロトコル: TCP Socket / Named Pipe             │ │ │
│  │  │ 機能:                                           │ │ │
│  │  │ ├ 高速バイナリ通信                             │ │ │
│  │  │ ├ プロセス分離・セキュリティ                   │ │ │
│  │  │ ├ 自動プロセス管理                             │ │ │
│  │  │ └ デバッグ・ロギング統合                       │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  接続フロー:                                            │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 1. クライアント接続要求                             │ │
│  │    ├ プロトコル自動検出                             │ │
│  │    ├ 認証トークン検証                               │ │
│  │    └ セッション確立                                 │ │
│  │                                                     │ │
│  │ 2. サービス初期化                                   │ │
│  │    ├ 要求されたサービスの有効化                     │ │
│  │    ├ アダプター接続確立                             │ │
│  │    └ 初期データ同期                                 │ │
│  │                                                     │ │
│  │ 3. リアルタイム監視開始                             │ │
│  │    ├ メトリクス定期収集                             │ │
│  │    ├ イベントストリーミング                         │ │
│  │    └ アラート・通知配信                             │ │
│  │                                                     │ │
│  │ 4. 適切な切断・クリーンアップ                       │ │
│  │    ├ サービス接続の終了                             │ │
│  │    ├ リソースの解放                                 │ │
│  │    └ セッション状態の保存                           │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2 認証・セキュリティ

```
┌─────────────────────────────────────────────────────────┐
│                認証・セキュリティ                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  認証フロー:                                            │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 1. トークンベース認証                               │ │
│  │    ├ JWT (JSON Web Token) 標準準拠                  │ │
│  │    ├ 有効期限・自動更新                             │ │
│  │    ├ スコープベース権限制御                         │ │
│  │    └ 署名検証・改ざん防止                           │ │
│  │                                                     │ │
│  │ 2. サービス別認証統合                               │ │
│  │    ├ Vercel: Personal Access Token                 │ │
│  │    ├ Supabase: Service Role Key                    │ │
│  │    ├ AWS: Access Key ID / Secret Access Key        │ │
│  │    ├ GitHub: Personal Access Token / GitHub App    │ │
│  │    └ Cloudflare: API Token / Global API Key        │ │
│  │                                                     │ │
│  │ 3. セキュリティ機能                                 │ │
│  │    ├ レート制限 (100 req/min/client)               │ │
│  │    ├ IP許可リスト・地理的制限                       │ │
│  │    ├ SSL/TLS暗号化通信                              │ │
│  │    ├ セッション管理・タイムアウト                   │ │
│  │    └ 監査ログ・不正アクセス検知                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  設定例:                                                │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ // 認証設定                                         │ │
│  │ export interface AuthConfig {                       │ │
│  │   provider: string;                                 │ │
│  │   credentials: {                                    │ │
│  │     token?: string;                                 │ │
│  │     apiKey?: string;                                │ │
│  │     accessKeyId?: string;                           │ │
│  │     secretAccessKey?: string;                       │ │
│  │   };                                                │ │
│  │   scopes?: string[];                                │ │
│  │   expiresAt?: number;                               │ │
│  │ }                                                   │ │
│  │                                                     │ │
│  │ // 環境変数による設定                               │ │
│  │ FLUORITE_AUTH_TOKEN=xxxxx                           │ │
│  │ VERCEL_TOKEN=xxxxx                                  │ │
│  │ SUPABASE_SERVICE_ROLE_KEY=xxxxx                     │ │
│  │ AWS_ACCESS_KEY_ID=xxxxx                             │ │
│  │ AWS_SECRET_ACCESS_KEY=xxxxx                         │ │
│  │ GITHUB_TOKEN=xxxxx                                  │ │
│  │ CLOUDFLARE_API_TOKEN=xxxxx                          │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 5. ユーザーインターフェース

### 5.1 TUIダッシュボード設計

```
┌─────────────────────────────────────────────────────────┐
│                 TUIダッシュボード設計                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  レイアウトデザイン (grid):                             │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ ┌─────────┬─────────┬─────────┬─────────┐           │ │
│  │ │Services │ Health  │ Metrics │Actions  │           │ │
│  │ │Status   │Monitor  │Overview │Panel    │           │ │
│  │ │         │         │         │         │           │ │
│  │ │ ● Vercel│ ✅ OK   │📊 CPU   │🚀 Deploy│           │ │
│  │ │ ● AWS   │ ⚠️ WARN │📈 Memory│🔄 Restart│           │ │
│  │ │ ● GitHub│ ❌ ERROR│📉 Disk  │🛑 Stop  │           │ │
│  │ ├─────────┼─────────┴─────────┼─────────┤           │ │
│  │ │Projects │   Resource Usage  │Activity │           │ │
│  │ │List     │   (Live Charts)   │Log      │           │ │
│  │ │         │                   │         │           │ │
│  │ │📁 App1  │ ████████████░░ 75%│15:43:21 │           │ │
│  │ │📁 App2  │ ████████░░░░░░ 60%│Deploy OK│           │ │
│  │ │📁 App3  │ ██████████████ 90%│Error 500│           │ │
│  │ ├─────────┴───────────────────┴─────────┤           │ │
│  │ │           Real-time Events            │           │ │
│  │ │          (WebSocket Stream)           │           │ │
│  │ │                                       │           │ │
│  │ │ 🔄 [15:43:25] Vercel: Deploy started │           │ │
│  │ │ ✅ [15:43:20] AWS: EC2 instance up   │           │ │
│  │ │ ⚠️  [15:43:15] GitHub: Action failed │           │ │
│  │ └───────────────────────────────────────┘           │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  blessed-contrib 統合:                                  │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ import blessed from 'blessed';                      │ │
│  │ import contrib from 'blessed-contrib';              │ │
│  │                                                     │ │
│  │ // メイン画面初期化                                 │ │
│  │ const screen = blessed.screen({                     │ │
│  │   smartCSR: true,                                   │ │
│  │   title: 'Fluorite Dashboard'                       │ │
│  │ });                                                 │ │
│  │                                                     │ │
│  │ // グリッドレイアウト                               │ │
│  │ const grid = new contrib.grid({                     │ │
│  │   rows: 12,                                         │ │
│  │   cols: 12,                                         │ │
│  │   screen: screen                                    │ │
│  │ });                                                 │ │
│  │                                                     │ │
│  │ // ウィジェット配置                                 │ │
│  │ const serviceTable = grid.set(0, 0, 6, 3,           │ │
│  │   contrib.table, { label: 'Services' });           │ │
│  │ const metricsChart = grid.set(0, 3, 6, 6,           │ │
│  │   contrib.line, { label: 'Metrics' });             │ │
│  │ const logWidget = grid.set(6, 0, 6, 12,             │ │
│  │   contrib.log, { label: 'Activity Log' });         │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  インタラクション:                                      │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ キーボードショートカット:                           │ │
│  │ ├ q: 終了                                           │ │
│  │ ├ r: 手動リフレッシュ                               │ │
│  │ ├ s: サービス選択                                   │ │
│  │ ├ f: フィルター設定                                 │ │
│  │ ├ h: ヘルプ表示                                     │ │
│  │ ├ Tab: ウィジェット間移動                           │ │
│  │ └ Enter: アクション実行                             │ │
│  │                                                     │ │
│  │ マウス操作:                                         │ │
│  │ ├ クリック: 項目選択                               │ │
│  │ ├ ダブルクリック: 詳細表示                         │ │
│  │ ├ スクロール: リスト・ログ移動                     │ │
│  │ └ 右クリック: コンテキストメニュー                 │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 5.2 CLI・JSON出力

```
┌─────────────────────────────────────────────────────────┐
│                 CLI・JSON出力フォーマット               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  CLI出力例 (--mode cli):                                │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ $ fluorite-flake dashboard vercel --mode cli        │ │
│  │                                                     │ │
│  │ 🚀 Vercel Dashboard                                 │ │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │ │
│  │                                                     │ │
│  │ 📊 Account: my-team                                 │ │
│  │ 🌐 Projects: 5 active                               │ │
│  │ ✅ Status: All systems operational                  │ │
│  │                                                     │ │
│  │ Projects:                                           │ │
│  │ ┌─────────────┬────────────┬──────────────────┐     │ │
│  │ │ Name        │ Status     │ Last Deploy      │     │ │
│  │ ├─────────────┼────────────┼──────────────────┤     │ │
│  │ │ my-app      │ ✅ Ready  │ 2 hours ago      │     │ │
│  │ │ landing     │ 🔄 Building│ 5 minutes ago    │     │ │
│  │ │ blog        │ ✅ Ready  │ 1 day ago        │     │ │
│  │ └─────────────┴────────────┴──────────────────┘     │ │
│  │                                                     │ │
│  │ Recent Activity:                                    │ │
│  │ • 15:43:25 - my-app: Deploy successful             │ │
│  │ • 15:41:10 - landing: Build started                │ │
│  │ • 15:38:02 - blog: Environment updated             │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  JSON出力例 (--mode json):                              │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ $ fluorite-flake dashboard vercel --mode json       │ │
│  │                                                     │ │
│  │ {                                                   │ │
│  │   "service": "vercel",                              │ │
│  │   "timestamp": 1698765432123,                       │ │
│  │   "status": "healthy",                              │ │
│  │   "account": {                                      │ │
│  │     "id": "team_xxxxx",                             │ │
│  │     "name": "my-team",                              │ │
│  │     "plan": "pro"                                   │ │
│  │   },                                                │ │
│  │   "projects": [                                     │ │
│  │     {                                               │ │
│  │       "id": "prj_xxxxx",                            │ │
│  │       "name": "my-app",                             │ │
│  │       "status": "ready",                            │ │
│  │       "url": "https://my-app.vercel.app",           │ │
│  │       "lastDeploy": {                               │ │
│  │         "id": "dpl_xxxxx",                          │ │
│  │         "status": "success",                        │ │
│  │         "createdAt": "2023-10-31T14:43:25.000Z"     │ │
│  │       }                                             │ │
│  │     }                                               │ │
│  │   ],                                                │ │
│  │   "metrics": {                                      │ │
│  │     "requests": 15420,                              │ │
│  │     "bandwidth": "2.3GB",                           │ │
│  │     "errors": 12,                                   │ │
│  │     "responseTime": 145                             │ │
│  │   }                                                 │ │
│  │ }                                                   │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 6. コマンド仕様

### 6.1 dashboard コマンド詳細

```
┌─────────────────────────────────────────────────────────┐
│                dashboard コマンド仕様                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  基本構文:                                              │
│  fluorite-flake dashboard [service] [options]           │
│                                                         │
│  使用例:                                                │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ # 単一サービス監視                                  │ │
│  │ fluorite-flake dashboard vercel                     │ │
│  │ fluorite-flake dashboard supabase --theme light     │ │
│  │ fluorite-flake dashboard aws --region us-east-1     │ │
│  │                                                     │ │
│  │ # 複数サービス同時監視                              │ │
│  │ fluorite-flake dashboard multi vercel supabase     │ │
│  │ fluorite-flake dashboard all --layout tabs          │ │
│  │                                                     │ │
│  │ # 出力モード指定                                    │ │
│  │ fluorite-flake dashboard vercel --mode cli          │ │
│  │ fluorite-flake dashboard aws --json                 │ │
│  │                                                     │ │
│  │ # フィルタリング                                    │ │
│  │ fluorite-flake dashboard vercel --project my-app    │ │
│  │ fluorite-flake dashboard aws --env production       │ │
│  │                                                     │ │
│  │ # Tauriサイドカーモード                             │ │
│  │ fluorite-flake dashboard sidecar --port 9123       │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  オプション一覧:                                        │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ --mode <mode>         出力モード (tui|cli|json)     │ │
│  │ --theme <theme>       カラーテーマ (dark|light|auto)│ │
│  │ --layout <layout>     レイアウト (grid|tabs|split)  │ │
│  │ --refresh <interval>  リフレッシュ間隔（ミリ秒）    │ │
│  │ --json               JSON出力 (--mode json同等)    │ │
│  │ --host <host>        通信ホスト (default: 127.0.0.1)│ │
│  │ --port <port>        通信ポート (default: 9123)    │ │
│  │ --token <token>      認証トークン                  │ │
│  │ --protocol <proto>   プロトコル (ws|rest)          │ │
│  │ --project <project>  プロジェクトフィルタ          │ │
│  │ --region <region>    リージョンフィルタ            │ │
│  │ --env <environment>  環境フィルタ                  │ │
│  │ --sync              サービス間データ同期有効化     │ │
│  │ --aggregate         メトリクス集約有効化           │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 6.2 サブコマンド

```
┌─────────────────────────────────────────────────────────┐
│                   サブコマンド詳細                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  multi サブコマンド:                                    │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 目的: 複数サービスの同時監視                        │ │
│  │ 構文: dashboard multi <services...> [options]       │ │
│  │                                                     │ │
│  │ 例:                                                 │ │
│  │ fluorite-flake dashboard multi vercel aws github    │ │
│  │ fluorite-flake dashboard multi supabase turso \     │ │
│  │   --sync --aggregate                                │ │
│  │                                                     │ │
│  │ 機能:                                               │ │
│  │ ├ 複数サービスの並列データ取得                      │ │
│  │ ├ 統合メトリクス表示                               │ │
│  │ ├ サービス間相関分析                               │ │
│  │ └ 統一アクション実行                               │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  all サブコマンド:                                      │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 目的: 設定済み全サービスの監視                      │ │
│  │ 構文: dashboard all [options]                       │ │
│  │                                                     │ │
│  │ 例:                                                 │ │
│  │ fluorite-flake dashboard all --theme dark           │ │
│  │ fluorite-flake dashboard all --layout tabs          │ │
│  │                                                     │ │
│  │ 機能:                                               │ │
│  │ ├ 自動サービス検出・有効化                         │ │
│  │ ├ 設定ファイルからの認証情報読み込み               │ │
│  │ ├ 統合ヘルスチェック                               │ │
│  │ └ 包括的システム監視                               │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  sidecar サブコマンド:                                  │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 目的: Tauriアプリケーション用サイドカー             │ │
│  │ 構文: dashboard sidecar [options]                   │ │
│  │                                                     │ │
│  │ 例:                                                 │ │
│  │ fluorite-flake dashboard sidecar --port 9123        │ │
│  │ fluorite-flake dashboard sidecar \                  │ │
│  │   --services vercel,aws --token xxx                 │ │
│  │                                                     │ │
│  │ 機能:                                               │ │
│  │ ├ 軽量バックグラウンドプロセス                     │ │
│  │ ├ IPC通信インターフェース                          │ │
│  │ ├ Tauriフロントエンドとの統合                      │ │
│  │ └ 最小リソース使用量                               │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 7. 拡張性・カスタマイズ

### 7.1 新サービス追加ガイド

```
┌─────────────────────────────────────────────────────────┐
│                新サービス追加手順                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. サービスアダプター実装                              │
│     └ src/services/adapters/[service]-adapter.ts        │
│                                                         │
│  2. ファクトリー登録                                    │
│     └ src/services/service-factory.ts 更新             │
│                                                         │
│  3. TUIダッシュボード                                   │
│     └ src/tui/service-dashboards/[service]-dashboard.ts │
│                                                         │
│  4. コマンド統合                                        │
│     └ src/commands/multi-dashboard.ts 更新              │
│                                                         │
│  5. 型定義追加                                          │
│     └ src/types/ 関連型を追加                           │
│                                                         │
│  6. テスト作成                                          │
│     ├ test/unit/services/[service]-adapter.test.ts      │
│     └ test/functional/dashboard/[service].test.ts       │
│                                                         │
│  7. ドキュメント更新                                    │
│     ├ README.md                                         │
│     └ docs/ 関連ファイル                                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 7.2 カスタムウィジェット

```
┌─────────────────────────────────────────────────────────┐
│               カスタムウィジェット開発                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ベースウィジェットクラス:                              │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ // src/tui/components/base-widget.ts                │ │
│  │ export abstract class BaseWidget {                  │ │
│  │   protected screen: blessed.Widgets.Screen;         │ │
│  │   protected element: blessed.Widgets.Element;       │ │
│  │                                                     │ │
│  │   constructor(options: WidgetOptions) {             │ │
│  │     this.screen = options.screen;                   │ │
│  │     this.createElement(options);                    │ │
│  │   }                                                 │ │
│  │                                                     │ │
│  │   abstract createElement(options: WidgetOptions):   │ │
│  │     void;                                           │ │
│  │   abstract update(data: any): void;                 │ │
│  │   abstract destroy(): void;                         │ │
│  │                                                     │ │
│  │   protected setupEventHandlers(): void {            │ │
│  │     // 共通イベントハンドリング                     │ │
│  │   }                                                 │ │
│  │                                                     │ │
│  │   protected render(): void {                        │ │
│  │     this.screen.render();                           │ │
│  │   }                                                 │ │
│  │ }                                                   │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
│  カスタムウィジェット例:                                │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ export class MetricsChartWidget extends BaseWidget {│ │
│  │   private chart: contrib.Line;                      │ │
│  │                                                     │ │
│  │   createElement(options: WidgetOptions): void {     │ │
│  │     this.chart = contrib.line({                     │ │
│  │       style: { line: 'yellow', text: 'green' },     │ │
│  │       xLabelPadding: 3,                             │ │
│  │       xPadding: 5,                                  │ │
│  │       label: 'Performance Metrics'                  │ │
│  │     });                                             │ │
│  │                                                     │ │
│  │     this.element = this.chart;                      │ │
│  │     this.setupEventHandlers();                      │ │
│  │   }                                                 │ │
│  │                                                     │ │
│  │   update(metrics: ServiceMetrics): void {           │ │
│  │     const data = this.formatChartData(metrics);     │ │
│  │     this.chart.setData(data);                       │ │
│  │     this.render();                                  │ │
│  │   }                                                 │ │
│  │ }                                                   │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

*次章: [05_テスト戦略](./05_テスト戦略.md)*