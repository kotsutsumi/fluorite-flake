# 開発ガイドライン

fluorite-flake プロジェクトの開発における重要な規約とベストプラクティスをまとめています。

## 目次
- [一時ファイル管理](#一時ファイル管理)
- [コーディング規約](#コーディング規約)
- [モジュール構造](#モジュール構造)
- [テスト方針](#テスト方針)
- [ドキュメント管理](#ドキュメント管理)

## 一時ファイル管理

### ディレクトリ構造

```
temp/                    # 一時ファイル用ルート（.gitignore済み）
├── scripts/            # 一時的なスクリプト・デバッグツール
│   └── run-e2e-debug.sh
├── docs/              # 一時的なドキュメント・メモ
│   └── analysis.md
├── test-outputs/      # テスト実行時の一時出力
│   ├── coverage-reports/
│   ├── screenshots/
│   └── generated-projects/
└── cache/             # ビルドキャッシュなど
    └── .next/
```

### 管理方針

#### 1. 一時ファイルの配置ルール

```bash
# ❌ 避けるべき配置
/run-debug.sh              # ルートに直接配置
/temp-analysis.md          # ルートに直接配置
/test-project-output/      # ルートに直接配置

# ✅ 正しい配置
/temp/scripts/run-debug.sh         # スクリプト専用ディレクトリ
/temp/docs/temp-analysis.md        # ドキュメント専用ディレクトリ
/temp/test-outputs/test-project/   # テスト出力専用ディレクトリ
```

#### 2. 用途別の配置先

| 種類 | 配置先 | 例 |
|------|--------|-----|
| デバッグスクリプト | `temp/scripts/` | `run-e2e-debug.sh`, `analyze-bundle.sh` |
| 一時的なドキュメント | `temp/docs/` | `investigation.md`, `todo.txt` |
| テスト出力 | `temp/test-outputs/` | 生成されたプロジェクト、カバレッジレポート |
| ビルドキャッシュ | `temp/cache/` | `.next/`, `dist/`, `node_modules/.cache/` |

#### 3. クリーンアップ

```bash
# 一時ファイルを全てクリーンアップ
pnpm clean:temp

# 特定のカテゴリのみクリーンアップ
pnpm clean:scripts
pnpm clean:test-outputs
```

## コーディング規約

### 日本語コメントの記載

```typescript
// ❌ 避けるべきコメント
// Process input

// ✅ 推奨されるコメント
/**
 * ユーザー入力を処理し、検証を行う
 *
 * 処理内容:
 * 1. 空白文字のトリミング
 * 2. 特殊文字のエスケープ
 * 3. バリデーションルールの適用
 *
 * @param input - ユーザーからの生の入力文字列
 * @returns 検証済みの安全な文字列
 */
```

### 1ファイル1定義の原則

```
src/commands/
├── dashboard/
│   ├── index.ts           # 統合エクスポート
│   ├── showDashboard.ts   # 単一の機能
│   ├── deployWorker.ts    # 単一の機能
│   ├── manageR2Bucket.ts  # 単一の機能
│   └── tailWorkerLogs.ts  # 単一の機能
└── multi-dashboard/
    ├── index.ts
    └── orchestrator.ts
```

#### モジュール分割の基準

```typescript
// ❌ 避けるべき構造 (multiple-exports.ts)
export function createProject() { /* ... */ }
export function updateProject() { /* ... */ }
export class ProjectManager { /* ... */ }
export interface ProjectConfig { /* ... */ }

// ✅ 推奨される構造
// create-project.ts
export function createProject() { /* ... */ }

// update-project.ts
export function updateProject() { /* ... */ }

// project-manager.ts
export class ProjectManager { /* ... */ }

// types.ts (型定義は1ファイルにまとめてもOK)
export interface ProjectConfig { /* ... */ }
export interface ProjectOptions { /* ... */ }
```

## モジュール構造

### インポート順序

```typescript
// 1. Node.js組み込みモジュール
import fs from 'fs-extra';
import path from 'path';

// 2. 外部パッケージ
import chalk from 'chalk';
import ora from 'ora';

// 3. 内部モジュール（絶対パス）
import { logger } from '@/utils/logger';
import { config } from '@/config';

// 4. 内部モジュール（相対パス）
import { helperFunction } from './helper.js';
import type { LocalType } from './types.js';
```

### ファイル拡張子の明示

```typescript
// ❌ ESモジュールでは拡張子を省略しない
import { helper } from './helper';

// ✅ 必ず.js拡張子を付ける（TypeScriptファイルでも）
import { helper } from './helper.js';
```

## テスト方針

### テストとコードの同時更新

```bash
# 開発フロー
1. 機能を実装/修正
   └── src/commands/dashboard/showDashboard.ts を修正

2. 対応するテストを更新
   └── test/unit/commands/dashboard/showDashboard.test.ts を更新

3. テストを実行して確認
   └── pnpm test:unit commands/dashboard

4. 全テストを実行
   └── pnpm test

5. コミット
   └── git commit -m "feat: ダッシュボード表示機能を改善"
```

### テストファイルの命名規則

```
src/utils/logger.ts
→ test/unit/utils/logger.test.ts

src/commands/dashboard/showDashboard.ts
→ test/unit/commands/dashboard/showDashboard.test.ts

src/generators/nextjs/generator.ts
→ test/unit/generators/nextjs/generator.test.ts
```

## ドキュメント管理

### ドキュメント構造

```
docs/
├── 00_概要.md               # プロジェクト全体の概要
├── 01_プロジェクト構造.md    # ディレクトリ構造
├── 02_CLIアーキテクチャ.md  # CLI設計
├── 03_ジェネレーター設計.md  # ジェネレーター詳細
├── 04_ダッシュボード機能.md  # ダッシュボード
├── 05_テスト戦略.md         # テスト方針
├── 06_ユーティリティ.md     # 共通機能
├── 07_デプロイメント.md     # デプロイ設定
└── 08_開発ガイドライン.md   # このドキュメント
```

### ドキュメント更新ルール

1. **機能追加時**: 該当するドキュメントを必ず更新
2. **仕様変更時**: 影響を受ける全てのドキュメントを更新
3. **バグ修正時**: 必要に応じて関連ドキュメントを更新

### ASCIIアートによる図表

```
┌─────────────────────────────────────────────────────────┐
│                    fluorite-flake CLI                    │
├─────────────────────────────────────────────────────────┤
│  Commands       │  Generators      │  Services          │
├─────────────────┼──────────────────┼────────────────────┤
│  • dashboard    │  • nextjs        │  • cloudflare      │
│  • generate     │  • expo          │  • supabase        │
│  • multi-dash   │  • flutter       │  • vercel          │
│                 │  • tauri         │  • turso           │
└─────────────────┴──────────────────┴────────────────────┘
```

## 継続的改善

### レビューポイント

- [ ] 日本語コメントが適切に記載されているか
- [ ] 1ファイル1定義の原則が守られているか
- [ ] テストが同時に更新されているか
- [ ] 一時ファイルが適切な場所にあるか
- [ ] ドキュメントが最新化されているか

### 開発者チェックリスト

```bash
# コミット前チェックリスト
□ pnpm format      # コードフォーマット
□ pnpm lint        # Lintチェック
□ pnpm test        # テスト実行
□ pnpm build       # ビルド確認
□ git status       # 一時ファイルが含まれていないか確認
```

---

**最終更新**: 2024年9月
**メンテナー**: fluorite-flake 開発チーム